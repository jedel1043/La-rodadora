<Chat>
    MDBoxLayout:
        height: root.height
        width: root.width
        orientation: "vertical"
        md_bg_color: 0,0.5,0.3,1


        MDTopAppBar:
            left_action_items: [["menu", lambda x: x, "", "", app.theme_cls.icon_color]]
            right_action_items: [["volume-high", lambda x: app.chat.toggle_mute(x), "Silenciar", "", app.theme_cls.icon_color]]
            elevation: 1

        MDRelativeLayout:
            Image:
                source: "assets/background.jpeg"
                fit_mode: "cover"

            MDBoxLayout:
                orientation: "horizontal"
                padding: 30, 30

                MDRelativeLayout:
                    size_hint: 0.4, 1

                    Image:
                        source: "assets/raccoon/character-art/mapache-default.gif"
                        size_hint: None, None
                        size: self.parent.width, self.parent.width/self.image_ratio
                        anim_delay:0.03333
                        mipmap: True
                        keep_data: True

                PBoxLayout:
                    orientation: "vertical"
                    spacing: 25

                    RecycleView:
                        id: chat_rv
                        data: root.messages
                        viewclass: "ChatBubble"

                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 1
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [dp(8), ]

                        RecycleBoxLayout:
                            id: chat_box
                            padding: dp(10)
                            spacing: dp(15)
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_size[1]
                            default_size_hint: .8, None
                            default_size: None, None

                    MDBoxLayout
                        spacing: 10
                        size_hint_y: None
                        height: 50

                        MDRelativeLayout:
                            size_hint: 0.1, 1
                            MDIconButton:
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                on_release: root.record_message()
                                icon: "microphone-message"
                                md_bg_color: app.theme_cls.accent_color
                                icon_color: app.theme_cls.icon_color
                            MDCard
                                id: recording_popup
                                padding: 4
                                md_bg_color: app.theme_cls.accent_color
                                size_hint: None, None
                                opacity: 0
                                disabled: True
                                size: "100dp", "30dp"
                                pos_hint: {'center_x': .5, 'y': 1.1}
                                _no_ripple_effect: True
                                PLabel:
                                    text: "Grabando..."

                        EnterTextField:
                            id: input
                            multiline: True
                            max_height: dp(75)
                            on_text_validate:
                                root.send(self.text.strip())
                                self.text = ''
                            hint_text: "Escribe una pregunta..."
                            fill_color_normal: app.theme_cls.primary_light
                            fill_color_focus: app.theme_cls.primary_light
                            text_color_normal: app.theme_cls.text_color
                            text_color_focus: app.theme_cls.text_color
                            hint_text_color_normal: 0, 0, 0, 0.3
                            hint_text_color_focus: app.theme_cls.primary_light
                            line_anim: False
                            active_line: False
                            mode: "fill"
                            radius: [10, 10, 10, 10]

                        MDIconButton:
                            on_release:
                                root.send(input.text.strip())
                                input.text = ''
                            icon: "send"
                            md_bg_color: app.theme_cls.primary_light
                            theme_icon_color: "Custom"
                            icon_color: app.theme_cls.text_color